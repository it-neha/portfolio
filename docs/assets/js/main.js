const resumeData = {
  name: "Neha Parmar",
  headline: "Full Stack Developer",
  summary:
    "Motivated and results-driven Full Stack Developer with hands-on experience across software design, development, and deployment. Proficient in .NET, React, Python, and cloud-based DevOps tooling, with a track record of orchestrating CI/CD pipelines, integrating APIs, and managing end-to-end project lifecycles in Agile environments.",
  taglines: [
    "full-stack platforms that feel effortless.",
    "cloud-native systems with measurable impact.",
    "DevOps pipelines that ship with confidence.",
    "experiences that delight humans and scale globally.",
  ],
  coreValues: [
    "Deliver scalable solutions that balance speed, quality, and maintainability.",
    "Champion collaborative Agile workflows and empathetic communication across teams.",
    "Continuously evolve skills across cloud, DevOps, and full-stack ecosystems.",
  ],
  contact: {
    location: "Surat, India",
    phone: "+91 8487896107",
    email: "nparmar1587@gmail.com",
    website: "https://it-neha.github.io/portfolio/",
    resume: "./assets/images/resume.pdf",
  },
  heroHighlights: [
    {
      icon: "fa-briefcase",
      label: "Current Role",
      value: "Full Stack Developer at Engross Infotech",
    },
    {
      icon: "fa-diagram-project",
      label: "Core Strength",
      value: "CI/CD, Cloud Deployments, API Integrations",
    },
    {
      icon: "fa-user-graduate",
      label: "Education",
      value: "B.Sc. IT, Veer Narmad South Gujarat University",
    },
    {
      icon: "fa-chart-line",
      label: "Mindset",
      value: "Iterate, measure, refine",
    },
  ],
  experience: [
    {
      company: "Engross Infotech",
      role: "Full Stack Developer",
      employmentType: "Full-time",
      location: "Surat, India",
      period: "Jan 2024 – Present",
      achievements: [
        "Design, develop, and maintain scalable full-stack web applications powered by .NET, React, and RESTful APIs.",
        "Implement CI/CD pipelines and automate deployments with Octopus Deploy, ArgoCD, and GitHub Actions for rapid releases.",
        "Collaborate with cross-functional teams to ensure seamless integration between frontend, backend, and cloud systems.",
        "Drive sprint planning, code reviews, and debugging efforts to uplift code quality and delivery efficiency.",
        "Built production-ready features while transitioning prototypes into stable deliverables within Agile cadences.",
        "Explored DevSecOps workflows, gaining exposure to Terraform, AWS services, and observability stacks.",
        "Supported CI/CD optimization initiatives and contributed to improving deployment visibility.",
      ],
      tags: ["Full Stack", "Cloud", "Agile"],
    },
    {
      company: "Engross Infotech",
      role: "Internship Trainee",
      employmentType: "Internship",
      location: "Surat, India",
      period: "Aug 2023 – Jan 2024",
      achievements: [
        "Learned the fundamentals of HTML and CSS for building responsive layouts.",
        "Practiced JavaScript with jQuery and AJAX to handle DOM interactions and API requests.",
        "Built small React components and explored hooks, state/props, and basic routing.",
        "Gained introductory experience with .NET for creating simple APIs.",
        "Used Git and GitHub for basic version control and collaboration.",
      ],
      tags: ["Internship", "HTML/CSS", "React", ".NET", "jQuery/AJAX"],
    },
  ],
  projects: [
    {
      name: "FeedbackHQ",
      stack: ".NET API · React",
      summary:
        "Customer feedback management platform featuring Stripe payment integration, webhook orchestration via ngrok, and audiovisual capture with SMTP-based notifications.",
      highlights: [
        "Stripe payments & webhooks",
        "Audio / video capture workflows",
        "Automated email notifications",
      ],
    },
    {
      name: "LikedIn.io",
      stack: ".NET MVC · Browser Automation",
      summary:
        "Web application enabling professionals to search, bookmark, and organize LikedIn posts with secure authentication and extension-driven downloads.",
      highlights: [
        "LikedIn OAuth integration",
        "Saved post organization",
        "Browser extension delivery",
      ],
    },
    {
      name: "CCM-Progleasing",
      stack: ".NET · AWS Cloud",
      summary:
        "Multi-application AWS deployment leveraging EKS, CircleCI pipelines, Octopus Deploy orchestration, and ArgoCD for Kubernetes operations accompanied by Terraform automation.",
      highlights: [
        "CircleCI + Octopus Deploy",
        "AWS EKS with ArgoCD",
        "Terraform infrastructure provisioning",
      ],
    },
    {
      name: "PodBooster",
      stack: "Python · Django",
      summary:
        "Podcast growth toolkit pairing targeted Google Ads campaign management with audience verification, email relay workflows, and embedded audio playback.",
      highlights: [
        "Google Ads campaign automation",
        "reCAPTCHA verification",
        "Shiwasa audio player integration",
      ],
    },
    {
      name: "Smart Health Prediction (Internship Project)",
      stack: "PHP · Laravel",
      summary:
        "Health prediction system that allows users to enter symptoms and receive possible disease predictions, featuring a doctor directory, patient feedback module, and an administrator dashboard for system management.",
      highlights: [
        "Symptom-based disease prediction",
        "Doctor contact directory",
        "User feedback and admin dashboard",
      ],
    },
  ],
  skills: [
    {
      category: "Programming & Frameworks",
      icon: "fa-code",
      items: [
        ".NET",
        "React",
        "Java",
        "Python",
        "Django",
        "Android",
        ".NET MVC",
        "Vue.js",
        "JavaScript",
        "C/C++",
        "PHP",
        "Laravel",
        "VB.NET",
      ],
    },
    {
      category: "Databases",
      icon: "fa-database",
      items: ["MySQL", "MongoDB", "SQL Server", "MySQL Workbench"],
    },
    {
      category: "DevOps & Tools",
      icon: "fa-gears",
      items: [
        "CI/CD",
        "Octopus Deploy",
        "ArgoCD",
        "Git/GitHub",
        "CircleCI",
        "CyberArk",
        "Jira",
        "SonarQube",
      ],
    },
    {
      category: "Cloud & Infrastructure",
      icon: "fa-cloud",
      items: ["AWS", "Terraform", "Kubernetes (EKS)"],
    },
    {
      category: "Monitoring & Communication",
      icon: "fa-chart-area",
      items: ["Splunk", "Grafana", "RabbitMQ", "Redis", "Slack", "Google Ads"],
    },
  ],
  education: {
    degree: "Bachelor of Science in Information Technology",
    institution: "Veer Narmad South Gujarat University",
    period: "Jun 2020 – Jun 2023",
    grade: "CGPA: 7.8 / 10",
    highlights: [
      "Focused on full-stack paradigms, database design, and software engineering fundamentals.",
      "Completed capstone prototypes emphasising reliability and user-centred design.",
    ],
  },
  certifications: [
    {
      title: "Android Development Certificate",
      issuer: "Self-paced specialization",
      period: "Aug 2023 – Jan 2024",
      description:
        "Specialised in Android app architecture, API integration, and delivering intuitive mobile experiences.",
    },
  ],
  themes: [
    {
      id: "cosmic-aurora",
      name: "Cosmic Aurora",
      description: "Vibrant purples and teals with deep-space backdrop.",
      colors: {
        mode: "dark",
        background: "#050816",
        accent: "#22d3ee",
        primary: "#6366f1",
        secondary: "#a855f7",
      },
      darkMode: true,
    },
    {
      id: "dawn-horizon",
      name: "Dawn Horizon",
      description: "Warm sunrise palette blending coral, gold, and indigo.",
      colors: {
        mode: "light",
        background: "#f8f5f2",
        accent: "#f97316",
        primary: "#6366f1",
        secondary: "#facc15",
      },
      darkMode: false,
    },
    {
      id: "emerald-matrix",
      name: "Emerald Matrix",
      description: "Tech-inspired emeralds and cool grays.",
      colors: {
        mode: "dark",
        background: "#031716",
        accent: "#34d35cff",
        primary: "#14ce90ff",
        secondary: "#0b4a56ff",
      },
      darkMode: true,
    },
    {
      id: "crimson-spark",
      name: "Crimson Spark",
      description: "High-contrast crimson paired with charcoal neutrals.",
      colors: {
        mode: "dark",
        background: "#111014",
        accent: "#f87171",
        primary: "#ef4444",
        secondary: "#f59e0b",
      },
      darkMode: true,
    },
    {
      id: "noir-luxe",
      name: "Noir Luxe",
      description: "Minimalist charcoal with gold highlights.",
      colors: {
        mode: "dark",
        background: "#090909",
        accent: "#fbbf24",
        primary: "#d1a054",
        secondary: "#f59e0b",
      },
      darkMode: true,
    },
    {
      id: "azure-skyline",
      name: "Azure Skyline",
      description: "Light modern blues with crisp whites for maximum clarity.",
      colors: {
        mode: "light",
        background: "#f5f9ff",
        accent: "#0ea5e9",
        primary: "#2563eb",
        secondary: "#22d3ee",
      },
      darkMode: false,
    },
    {
      id: "charcoal-neon",
      name: "Charcoal Neon",
      description: "Dark charcoal base with electric neon accents.",
      colors: {
        mode: "dark",
        background: "#0b0f1d",
        accent: "#f0abfc",
        primary: "#22d3ee",
        secondary: "#f59e0b",
      },
      darkMode: true,
    },
    {
      id: "terracotta-zen",
      name: "Terracotta Zen",
      description:
        "Earthy terracotta and sage tones for a calm, creative feel.",
      colors: {
        mode: "light",
        background: "#fdf8f4",
        accent: "#d97706",
        primary: "#f97316",
        secondary: "#84cc16",
      },
      darkMode: false,
    },
    {
      id: "mono-glass",
      name: "Mono Glass",
      description: "Frosted glass monochrome with subtle blues.",
      colors: {
        mode: "dark",
        background: "#0f172a",
        accent: "#60a5fa",
        primary: "#38bdf8",
        secondary: "#22d3ee",
      },
      darkMode: true,
    },
    {
      id: "vintage-futura",
      name: "Vintage Futura",
      description: "Retro-inspired amber and teal with modern typography.",
      colors: {
        mode: "light",
        background: "#fef6e4",
        accent: "#f59e0b",
        primary: "#0ea5e9",
        secondary: "#f97316",
      },
      darkMode: false,
    },
  ],
};

$(function () {
  setBranding();
  highlightNavigation();

  if ($("#hero").length) {
    populateHeroSection();
    initTypedHeadline();
  }

  if ($("#about-summary").length) {
    populateAboutSection();
  }

  if ($("#experience-timeline").length) {
    populateExperienceSection();
  }

  if ($("#project-grid").length) {
    populateProjectsSection();
  }

  if ($("#skills-grid").length) {
    populateSkillsSection();
  }

  if ($("#education-card").length) {
    populateEducationSection();
  }

  if ($("#certifications-list").length) {
    populateCertifications();
  }

  if ($("#contact-details").length) {
    populateContactSection();
  }

  populateFooter();
  initScrollReveal();
  setupThemes();
});

function setBranding() {
  const brandName = resumeData.name.split(" ")[0];
  const $brandSpans = $(".navbar-brand span");
  if ($brandSpans.length) {
    $brandSpans.text(brandName);
  }
  const $navName = $("#nav-name");
  if ($navName.length) {
    $navName.text(brandName);
  }
}

function populateHeroSection() {
  $("#hero-name").text(resumeData.name);
  $("#hero-role").text(resumeData.headline);
  $("#hero-summary").text(resumeData.summary);
  $("#typed-headline").text("");

  const $heroActions = $("#hero-actions");
  const actions = [
    {
      label: "Download Resume",
      icon: "fa-download",
      href: resumeData.contact.resume,
      className: "btn btn-primary btn-lg shadow",
    },
    {
      label: "Email Neha",
      icon: "fa-envelope",
      href: `mailto:${resumeData.contact.email}`,
      className: "btn btn-outline-light btn-lg",
    },
  ];

  actions.forEach((action) => {
    const $button = $(`
      <a class="${action.className}" href="${action.href}" target="_blank" rel="noopener">
        <i class="fa-solid ${action.icon} me-2"></i>${action.label}
      </a>
    `);
    $heroActions.append($button);
  });

  renderHeroHighlights();
  renderHeroSocials();
}

function renderHeroHighlights() {
  const $heroStats = $("#hero-stats");
  if (!$heroStats.length) return;
  $heroStats.empty();

  resumeData.heroHighlights.forEach((highlight) => {
    const $item = $(`
      <li class="stats-item">
        <div class="icon-circle">
          <i class="fa-solid ${highlight.icon}"></i>
        </div>
        <div class="stats-content">
          <span class="badge bg-label text-uppercase">${highlight.label}</span>
          <p class="mb-0 fw-semibold">${highlight.value}</p>
        </div>
      </li>
    `);
    $heroStats.append($item);
  });
}

function renderHeroSocials() {
  const $socialLinks = $("#social-links");
  if (!$socialLinks.length) return;
  $socialLinks.empty();

  const socials = [
    {
      icon: "fa-location-dot",
      label: resumeData.contact.location,
      href: `https://maps.app.goo.gl/RQF7LcXpLnsiiGzr7`,
    },
    {
      icon: "fa-phone",
      label: resumeData.contact.phone,
      href: `tel:${resumeData.contact.phone.replace(/\s+/g, "")}`,
    },
    {
      icon: "fa-envelope",
      label: resumeData.contact.email,
      href: `mailto:${resumeData.contact.email}`,
    },
    {
      icon: "fa-globe",
      label: "Portfolio Site",
      href: resumeData.contact.website,
    },
  ];

  socials.forEach((item) => {
    const element = item.href
      ? `<a class="social-link" href="${item.href}" target="_blank" rel="noopener"><i class="fa-solid ${item.icon} me-3"></i>${item.label}</a>`
      : `<span class="social-link disabled"><i class="fa-solid ${item.icon} me-3"></i>${item.label}</span>`;

    $socialLinks.append($(element));
  });
}

function populateAboutSection() {
  $("#about-summary").text(resumeData.summary);

  const $coreValues = $("#core-values");
  $coreValues.empty();

  resumeData.coreValues.forEach((value) => {
    $coreValues.append(
      $(`
        <li class="d-flex gap-3">
          <span class="icon-circle icon-circle-sm">
            <i class="fa-solid fa-star"></i>
          </span>
          <span class="text-body-secondary">${value}</span>
        </li>
      `)
    );
  });
}

function populateExperienceSection() {
  const $timeline = $("#experience-timeline");
  $timeline.empty();

  resumeData.experience.forEach((role) => {
    const $item = $(`
      <article class="timeline-item">
        <div class="timeline-marker"></div>
        <div class="timeline-content card border-0 shadow-sm h-100">
          <div class="card-body p-4">
            <div class="d-flex justify-content-between flex-column flex-md-row gap-2 mb-3">
              <div>
                <h3 class="h4 mb-1">${role.role}</h3>
                <p class="mb-0 text-primary fw-semibold">${role.company}</p>
                <span class="badge bg-secondary-subtle text-secondary-emphasis mt-2">${
                  role.employmentType
                }</span>
              </div>
              <div class="text-md-end">
                <span class="text-muted d-block">${role.period}</span>
                <span class="text-muted">${role.location}</span>
              </div>
            </div>
            <ul class="timeline-list list-unstyled vstack gap-2">
              ${role.achievements
                .map(
                  (achievement) =>
                    `<li><i class="fa-solid fa-circle-check me-2 text-primary"></i>${achievement}</li>`
                )
                .join("")}
            </ul>
            <div class="d-flex flex-wrap gap-2 mt-4">
              ${role.tags
                .map(
                  (tag) =>
                    `<span class="badge rounded-pill bg-primary-soft text-primary">${tag}</span>`
                )
                .join("")}
            </div>
          </div>
        </div>
      </article>
    `);

    $timeline.append($item);
  });
}

function populateProjectsSection() {
  const $grid = $("#project-grid");
  $grid.empty();

  resumeData.projects.forEach((project) => {
    const $col = $(`
      <div class="col-md-6 col-xl-4">
        <div class="card project-card h-100 border-0 shadow-sm">
          <div class="card-body p-4 d-flex flex-column">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h3 class="h5 mb-0">${project.name}</h3>
              <span class="badge bg-primary-soft text-primary text-uppercase">${
                project.stack
              }</span>
            </div>
            <p class="text-body-secondary mb-3 flex-grow-1">${
              project.summary
            }</p>
            <ul class="list-unstyled vstack gap-2 small text-body-secondary">
              ${project.highlights
                .map(
                  (highlight) =>
                    `<li><i class="fa-solid fa-arrow-trend-up me-2 text-primary"></i>${highlight}</li>`
                )
                .join("")}
            </ul>
          </div>
        </div>
      </div>
    `);

    $grid.append($col);
  });
}

function populateSkillsSection() {
  const $skillsGrid = $("#skills-grid");
  $skillsGrid.empty();

  resumeData.skills.forEach((skillGroup) => {
    const $col = $(`
      <div class="col-md-6 col-xl-4">
        <div class="card h-100 border-0 shadow-sm">
          <div class="card-body p-4">
            <div class="d-flex align-items-center gap-3 mb-3">
              <span class="icon-circle icon-circle-lg">
                <i class="fa-solid ${skillGroup.icon}"></i>
              </span>
              <h3 class="h5 mb-0">${skillGroup.category}</h3>
            </div>
            <div class="d-flex flex-wrap gap-2">
              ${skillGroup.items
                .map(
                  (item) => `
                    <span class="skill-badge" data-skill-group="${skillGroup.category.replace(
                      /[\s&]/g,
                      "-"
                    )}">
                      <i class="fa-solid fa-wand-magic-sparkles me-2"></i>${item}
                    </span>
                  `
                )
                .join("")}
            </div>
          </div>
        </div>
      </div>
    `);

    $skillsGrid.append($col);
  });
}

function populateEducationSection() {
  const education = resumeData.education;
  const $card = $(`
    <div class="card-body p-4">
      <h3 class="h4">${education.degree}</h3>
      <p class="text-primary fw-semibold mb-1">${education.institution}</p>
      <span class="text-muted d-block">${education.period}</span>
      <span class="badge bg-primary-soft text-primary mt-3">${
        education.grade
      }</span>
      <ul class="list-unstyled vstack gap-2 mt-4 text-body-secondary">
        ${education.highlights
          .map(
            (item) =>
              `<li><i class="fa-solid fa-book-open me-2 text-primary"></i>${item}</li>`
          )
          .join("")}
      </ul>
    </div>
  `);

  $("#education-card").empty().append($card);
}

function populateCertifications() {
  const $list = $("#certifications-list");
  $list.empty();

  resumeData.certifications.forEach((cert) => {
    const $item = $(`
      <li class="d-flex flex-column flex-md-row gap-3">
        <span class="icon-circle icon-circle-md">
          <i class="fa-solid fa-award"></i>
        </span>
        <div>
          <h3 class="h6 mb-1">${cert.title}</h3>
          <p class="mb-1 text-primary fw-semibold">${cert.issuer}</p>
          <span class="text-muted small d-block mb-2">${cert.period}</span>
          <p class="mb-0 text-body-secondary">${cert.description}</p>
        </div>
      </li>
    `);

    $list.append($item);
  });
}

function populateContactSection() {
  const $details = $("#contact-details");
  $details.empty();

  const contactInfo = [
    {
      icon: "fa-location-dot",
      title: "Location",
      value: resumeData.contact.location,
      href: `https://maps.app.goo.gl/RQF7LcXpLnsiiGzr7`,
    },
    {
      icon: "fa-phone",
      title: "Phone",
      value: resumeData.contact.phone,
      href: `tel:${resumeData.contact.phone.replace(/\s+/g, "")}`,
    },
    {
      icon: "fa-envelope",
      title: "Email",
      value: resumeData.contact.email,
      href: `mailto:${resumeData.contact.email}`,
    },
    {
      icon: "fa-globe",
      title: "Website",
      value: resumeData.contact.website,
      href: resumeData.contact.website,
    },
  ];

  contactInfo.forEach((info) => {
    const $col = $(`
      <div class="col-sm-6">
        <div class="contact-card h-100">
          <div class="d-flex align-items-start gap-3">
            <span class="icon-circle icon-circle-md">
              <i class="fa-solid ${info.icon}"></i>
            </span>
            <div>
              <h4 class="h6 text-uppercase text-primary mb-1">${info.title}</h4>
              ${
                info.href
                  ? `<a class="stretched-link text-decoration-none text-body" href="${info.href}" target="_blank" rel="noopener">${info.value}</a>`
                  : `<span class="text-body">${info.value}</span>`
              }
            </div>
          </div>
        </div>
      </div>
    `);

    $details.append($col);
  });
}

function populateFooter() {
  const year = new Date().getFullYear();
  $("#footer-text").text(
    `© ${year} ${resumeData.name}. Crafted with curiosity and care.`
  );
}

function highlightNavigation() {
  const currentPage = $("body").data("page") || "";
  if (!currentPage) return;

  const activeHref =
    currentPage === "home" ? "index.html" : `${currentPage}.html`;

  $(".main-nav .nav-link").each(function () {
    const href = $(this).attr("href") || "";
    if (href === activeHref) {
      $(this).addClass("active");
    }
  });
}

function initTypedHeadline() {
  const $typed = $("#typed-headline");
  if (
    !$typed.length ||
    !Array.isArray(resumeData.taglines) ||
    !resumeData.taglines.length
  )
    return;

  const phrases = resumeData.taglines;
  let phraseIndex = 0;
  let charIndex = 0;
  let isDeleting = false;
  const typingSpeed = 65;
  const deletionSpeed = 30;
  const holdTime = 1700;

  function type() {
    const currentPhrase = phrases[phraseIndex];

    if (!isDeleting && charIndex <= currentPhrase.length) {
      $typed.text(currentPhrase.substring(0, charIndex));
      if (charIndex === currentPhrase.length) {
        setTimeout(() => {
          isDeleting = true;
          type();
        }, holdTime);
        return;
      }
      charIndex++;
      setTimeout(type, typingSpeed + Math.random() * 45);
      return;
    }

    if (isDeleting && charIndex >= 0) {
      $typed.text(currentPhrase.substring(0, charIndex));
      if (charIndex === 0) {
        isDeleting = false;
        phraseIndex = (phraseIndex + 1) % phrases.length;
      } else {
        charIndex--;
      }
      setTimeout(type, deletionSpeed + Math.random() * 35);
    }
  }

  setTimeout(type, 800);
}

function initScrollReveal() {
  const $elements = $(".reveal-up");
  if (!$elements.length) return;

  if ("IntersectionObserver" in window) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            $(entry.target).addClass("is-visible");
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.2 }
    );

    $elements.each(function () {
      observer.observe(this);
    });
    return;
  }

  function revealOnScrollFallback() {
    const triggerBottom = window.innerHeight * 0.85;

    $elements.each(function () {
      const elementTop = this.getBoundingClientRect().top;
      if (elementTop < triggerBottom) {
        $(this).addClass("is-visible");
      }
    });
  }

  revealOnScrollFallback();
  $(window).on("scroll resize", revealOnScrollFallback);
}

function injectThemeMetadata() {
  if (!resumeData.themes || !resumeData.themes.length) return;

  const $existing = $("#theme-config");
  if ($existing.length) {
    $existing.remove();
  }

  const $script = $("<script>", {
    id: "theme-config",
    type: "application/json",
  });
  $script.text(JSON.stringify(resumeData.themes, null, 2));
  $("body").append($script);
}

const THEME_STORAGE_KEY = "portfolio_theme_id";
let currentThemeId = null;

function setupThemes() {
  if (!Array.isArray(resumeData.themes) || !resumeData.themes.length) return;

  injectThemeMetadata();
  renderThemeSwitcher();

  const storedTheme = localStorage.getItem(THEME_STORAGE_KEY);
  const fallbackTheme = resumeData.themes[0].id;
  const initialTheme = resumeData.themes.some(
    (theme) => theme.id === storedTheme
  )
    ? storedTheme
    : fallbackTheme;
  applyTheme(initialTheme);
}

function renderThemeSwitcher() {
  $("#theme-switcher").remove();

  const $switcher = $(`
    <div id="theme-switcher" class="theme-switcher">
      <button class="theme-toggle" type="button" aria-haspopup="true" aria-expanded="false">
        <i class="fa-solid fa-palette"></i>
        <span class="visually-hidden">Toggle theme palette</span>
      </button>
      <div class="theme-panel" role="listbox">
        <div class="theme-panel-header">
          <h3 class="theme-panel-title">Theme Studio</h3>
          <p class="theme-panel-subtitle">Explore crafted color systems.<br /><span class="theme-mode-note">Dark mode availability shown below.</span></p>
        </div>
        <div class="theme-grid"></div>
      </div>
    </div>
  `);

  const $grid = $switcher.find(".theme-grid");

  resumeData.themes.forEach((theme) => {
    const modeLabel = theme.darkMode
      ? theme.colors.mode === "light"
        ? "Dual Tone"
        : "Dark UI"
      : "Light UI";
    const $item = $(`
      <button class="theme-item" type="button" role="option" data-theme-id="${theme.id}" data-theme-mode="${theme.colors.mode}">
        <span class="theme-swatch" style="--swatch-primary:${theme.colors.primary}; --swatch-accent:${theme.colors.accent}; --swatch-secondary:${theme.colors.secondary};"></span>
        <span class="theme-meta">
          <span class="theme-name">${theme.name}</span>
          <span class="theme-mode">${modeLabel}</span>
        </span>
        <span class="theme-status" aria-hidden="true">
          <i class="fa-solid fa-check"></i>
        </span>
      </button>
    `);
    $grid.append($item);
  });

  $("body").append($switcher);

  const $toggle = $switcher.find(".theme-toggle");
  const $panel = $switcher.find(".theme-panel");

  $toggle.on("click", function (event) {
    event.stopPropagation();
    const isOpen = $switcher.hasClass("open");
    $switcher.toggleClass("open", !isOpen);
    $toggle.attr("aria-expanded", String(!isOpen));
  });

  $(document)
    .off("click.themeSwitcher")
    .on("click.themeSwitcher", (event) => {
      if (!$(event.target).closest("#theme-switcher").length) {
        $switcher.removeClass("open");
        $toggle.attr("aria-expanded", "false");
      }
    });

  $panel.find(".theme-item").on("click", function () {
    const themeId = $(this).data("theme-id");
    applyTheme(themeId);
    $switcher.removeClass("open");
    $toggle.attr("aria-expanded", "false");
  });
}

function applyTheme(themeId) {
  const theme =
    resumeData.themes.find((item) => item.id === themeId) ||
    resumeData.themes[0];
  if (!theme) return;

  const root = document.documentElement;
  const background = theme.colors.background;
  const primary = theme.colors.primary;
  const secondary = theme.colors.secondary;
  const accent = theme.colors.accent;
  const isDark = (theme.colors.mode || "dark") === "dark";

  const bgMid = adjustLightness(background, isDark ? 6 : -8);
  const bgSoft = adjustLightness(background, isDark ? 14 : -12);
  const surface = adjustLightness(background, isDark ? 22 : -10);
  const surfaceAlt = adjustLightness(background, isDark ? 28 : -15);
  const surfaceElevated = adjustLightness(background, isDark ? 36 : -20);

  const text100 = isDark ? "#f8fafc" : "#0f172a";
  const text200 = isDark ? "#e2e8f0" : "#1f2937";
  const textMuted = isDark
    ? "rgba(196, 209, 232, 0.85)"
    : "rgba(71, 85, 105, 0.72)";
  const text100Rgb = rgbToString(hexToRgb(text100));
  const text200Rgb = rgbToString(hexToRgb(text200));
  const textMutedRgb = extractRgbValues(textMuted);

  const navBgHex = isDark ? bgMid : "#ffffff";
  const navBg = rgbToString(hexToRgb(navBgHex));
  const navBorder = toRgba(
    isDark ? "#ffffff" : "#0f172a",
    isDark ? 0.12 : 0.16
  );
  const navLink = isDark
    ? "rgba(255, 255, 255, 0.88)"
    : "rgba(15, 23, 42, 0.82)";

  const cardBg = toRgba(surfaceAlt, isDark ? 0.92 : 0.97);
  const cardBgAlt = toRgba(surfaceElevated, isDark ? 0.96 : 0.98);
  const cardOverlay = toRgba(
    isDark ? "#ffffff" : "#000000",
    isDark ? 0.04 : 0.08
  );

  const quickLinkBg = toRgba(primary, isDark ? 0.24 : 0.32);
  const quickLinkHover = toRgba(primary, isDark ? 0.34 : 0.42);
  const socialBg = isDark ? toRgba("#ffffff", 0.2) : toRgba("#ffffff", 0.82);
  const socialHover = isDark ? toRgba("#ffffff", 0.3) : toRgba("#ffffff", 0.92);
  const contactBg = toRgba(surfaceElevated, isDark ? 0.96 : 0.99);
  const footerBg = isDark ? toRgba(bgMid, 0.9) : toRgba("#ffffff", 0.94);
  const footerText = isDark ? toRgba(text200, 0.72) : toRgba(text200, 0.82);
  const footerBorder = toRgba(
    isDark ? "#ffffff" : "#0f172a",
    isDark ? 0.18 : 0.12
  );

  const glassSurface = isDark
    ? toRgba("#ffffff", 0.26)
    : toRgba("#ffffff", 0.82);
  const glassSurfaceElevated = isDark
    ? toRgba("#ffffff", 0.36)
    : toRgba("#ffffff", 0.9);
  const glassBorder = isDark
    ? toRgba("#ffffff", 0.36)
    : toRgba("#000000", 0.16);
  const glassHighlight = toRgba(accent, isDark ? 0.4 : 0.32);
  const glassGradient = `linear-gradient(135deg, ${toRgba(
    primary,
    isDark ? 0.3 : 0.24
  )}, ${toRgba(accent, isDark ? 0.22 : 0.18)})`;

  const borderSoft = toRgba(
    isDark ? "#ffffff" : "#0f172a",
    isDark ? 0.08 : 0.12
  );
  const borderStrong = toRgba(
    isDark ? "#ffffff" : "#0f172a",
    isDark ? 0.18 : 0.18
  );

  const gradientBody = `radial-gradient(circle at 20% 20%, ${toRgba(
    primary,
    0.22
  )}, transparent 55%), radial-gradient(circle at 80% 0%, ${toRgba(
    accent,
    0.18
  )}, transparent 45%), ${background}`;
  const gradientHero = `radial-gradient(circle at top, ${toRgba(
    primary,
    0.4
  )}, transparent 65%), radial-gradient(circle at bottom, ${toRgba(
    secondary,
    0.3
  )}, transparent 60%)`;

  const shadowSoft = `0 25px 60px ${toRgba(
    adjustLightness(background, isDark ? -35 : -45),
    0.5
  )}`;
  const shadowGlow = `0 0 40px ${toRgba(primary, 0.45)}`;
  const shadowFloat = `0 35px 70px ${toRgba(
    adjustLightness(background, isDark ? -40 : -55),
    isDark ? 0.45 : 0.35
  )}`;

  setVar("--color-bg-main", background);
  setVar("--color-bg-mid", bgMid);
  setVar("--color-bg-soft", bgSoft);
  setVar("--color-surface", surface);
  setVar("--color-card-bg", glassSurface);
  setVar("--color-card-bg-alt", glassSurfaceElevated);
  setVar("--color-card-overlay", glassHighlight);

  setVar("--color-primary", primary);
  setVar("--color-primary-rgb", rgbToString(hexToRgb(primary)));
  setVar("--color-secondary", secondary);
  setVar("--color-secondary-rgb", rgbToString(hexToRgb(secondary)));
  setVar("--color-accent", accent);
  setVar("--color-accent-rgb", rgbToString(hexToRgb(accent)));

  setVar("--color-text-100", text100);
  setVar("--color-text-100-rgb", text100Rgb);
  setVar("--color-text-200", text200);
  setVar("--color-text-200-rgb", text200Rgb);
  setVar("--color-text-muted", textMuted);
  setVar("--color-text-muted-rgb", textMutedRgb);

  setVar("--color-nav-bg", navBg);
  setVar("--color-nav-border", navBorder);
  setVar("--color-nav-link", navLink);
  setVar("--color-border-soft", borderSoft);
  setVar("--color-border-strong", borderStrong);

  setVar("--color-quick-link-bg", quickLinkBg);
  setVar("--color-quick-link-hover", quickLinkHover);
  setVar("--color-social-bg", socialBg);
  setVar("--color-social-hover", socialHover);
  setVar("--color-contact-bg", contactBg);
  setVar("--color-footer-bg", footerBg);
  setVar("--color-footer-text", footerText);
  setVar("--color-footer-border", footerBorder);

  setVar("--gradient-body", gradientBody);
  setVar("--gradient-hero", gradientHero);
  setVar("--color-hero-glow-1", toRgba(primary, 0.68));
  setVar("--color-hero-glow-2", toRgba(accent, 0.6));
  setVar("--color-hero-glow-3", toRgba(secondary, 0.52));

  setVar("--shadow-soft", shadowSoft);
  setVar("--shadow-glow", shadowGlow);
  setVar("--shadow-float", shadowFloat);

  setVar("--color-theme-panel-bg", glassSurfaceElevated);
  setVar("--color-theme-panel-border", glassBorder);
  setVar("--color-theme-toggle-bg", glassSurface);
  setVar("--color-theme-toggle-border", glassBorder);
  setVar("--color-theme-toggle-hover", toRgba(primary, 0.25));
  setVar("--color-scroll-indicator", toRgba("#ffffff", isDark ? 0.55 : 0.7));
  setVar("--glass-surface", glassSurface);
  setVar("--glass-surface-elevated", glassSurfaceElevated);
  setVar("--glass-border", glassBorder);
  setVar("--glass-highlight", glassHighlight);
  setVar("--glass-gradient", glassGradient);

  document.body.dataset.themeId = theme.id;
  document.body.dataset.themeMode = isDark ? "dark" : "light";

  currentThemeId = theme.id;
  localStorage.setItem(THEME_STORAGE_KEY, theme.id);

  updateThemeSwitcherActive(theme.id, isDark ? "Dark UI" : "Light UI");
}

function updateThemeSwitcherActive(themeId, modeLabel) {
  $(".theme-item").each(function () {
    const isActive = $(this).data("theme-id") === themeId;
    $(this).toggleClass("is-active", isActive);
    $(this).attr("aria-selected", String(isActive));
  });

  $("#theme-switcher .theme-toggle").attr("data-active-mode", modeLabel || "");
}

function setVar(name, value) {
  if (value !== undefined && value !== null) {
    document.documentElement.style.setProperty(name, value);
  }
}

function hexToRgb(hex) {
  let sanitized = hex.replace("#", "");
  if (sanitized.length === 3) {
    sanitized = sanitized
      .split("")
      .map((char) => char + char)
      .join("");
  }
  const intVal = parseInt(sanitized, 16);
  const r = (intVal >> 16) & 255;
  const g = (intVal >> 8) & 255;
  const b = intVal & 255;
  return { r, g, b };
}

function rgbToString({ r, g, b }) {
  return `${r}, ${g}, ${b}`;
}

function toRgba(hex, alpha = 1) {
  const { r, g, b } = typeof hex === "string" ? hexToRgb(hex) : hex;
  return `rgba(${r}, ${g}, ${b}, ${alpha})`;
}

function extractRgbValues(color) {
  if (typeof color !== "string") return "255, 255, 255";
  const match = color.match(/rgba?\(([^)]+)\)/i);
  if (!match) {
    // Attempt to interpret hex values
    return rgbToString(hexToRgb(color));
  }
  const parts = match[1]
    .split(",")
    .map((part) => parseFloat(part.trim()))
    .filter((_, index) => index < 3);
  while (parts.length < 3) {
    parts.push(255);
  }
  return parts.join(", ");
}

function adjustLightness(hex, percent) {
  const { h, s, l } = hexToHsl(hex);
  const adjusted = clamp(l + percent / 100, 0, 1);
  return hslToHex(h, s, adjusted);
}

function hexToHsl(hex) {
  const { r, g, b } = hexToRgb(hex);
  const rNorm = r / 255;
  const gNorm = g / 255;
  const bNorm = b / 255;

  const max = Math.max(rNorm, gNorm, bNorm);
  const min = Math.min(rNorm, gNorm, bNorm);
  let h = 0;
  let s = 0;
  const l = (max + min) / 2;

  if (max !== min) {
    const d = max - min;
    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
    switch (max) {
      case rNorm:
        h = (gNorm - bNorm) / d + (gNorm < bNorm ? 6 : 0);
        break;
      case gNorm:
        h = (bNorm - rNorm) / d + 2;
        break;
      case bNorm:
        h = (rNorm - gNorm) / d + 4;
        break;
    }
    h /= 6;
  }

  return { h, s, l };
}

function hslToHex(h, s, l) {
  const hue2rgb = (p, q, t) => {
    if (t < 0) t += 1;
    if (t > 1) t -= 1;
    if (t < 1 / 6) return p + (q - p) * 6 * t;
    if (t < 1 / 2) return q;
    if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
    return p;
  };

  let r;
  let g;
  let b;

  if (s === 0) {
    r = g = b = l;
  } else {
    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
    const p = 2 * l - q;
    r = hue2rgb(p, q, h + 1 / 3);
    g = hue2rgb(p, q, h);
    b = hue2rgb(p, q, h - 1 / 3);
  }

  const toHex = (x) => {
    const hex = Math.round(x * 255)
      .toString(16)
      .padStart(2, "0");
    return hex;
  };

  return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
}

function clamp(value, min, max) {
  return Math.min(Math.max(value, min), max);
}
